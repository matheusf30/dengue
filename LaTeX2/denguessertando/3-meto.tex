\chapter{Metodologia}

\section{Conjunto de Dados e Área de Estudo}

Para organização, os dados serão agrupados em três divisões distintas: 

\begin{alineas}
    \item \acrfull{DEE}: Elementos sanitários relacionados tanto ao vetor (dados entomológicos) quanto ao hospedeiro (dados epidemiológicos) e provenientes de bancos de dados oficiais. Os valores são relativos à quantidade de focos de \latim{Aedes} sp., disponibilizados oficialmente pela \acrshort{Dive}. Em relação à quantidade de casos de dengue, esses dados foram obtidos de plataformas \ingles{on-line}: TABNET-\acrshort{Sinan}-\acrshort{DataSUS} (base nacional) e TABNET-\acrshort{Sinan}-\acrshort{Dive} (base estadual); 
    
    \item \acrfull{DEC}: Informações referentes a variáveis meteorológicas/climatológicas (temperatura - mínima, máxima e média - e precipitação) e provenientes de banco de dados oficiais (reanálise e produtos de reanálise):  \ingles{\acrshort{GFS}}, \ingles{\acrshort{MERGE}} e \ingles{\acrshort{SAMeT}};

    \item \acrfull{DGR}: Informações relacionadas aos aspectos geográficos atualizados para o momento atual, provenientes do \acrshort{IBGE}. 
\end{alineas}

\indent Os dados de precipitação acumulada a superfície (mm), são armazenados no produto \ingles{\acrshort{MERGE}},  sendo adquiridos dados diários a partir de junho de 2000.\\
\indent Os dados do \ingles{\acrshort{SAMeT}} são aferidos a dois metros (2m) da superfície em escala de temperaturas dadas em celsius (C), agrupados em médias diárias e com série histórica iniciando em janeiro de 2000.\\
\indent \textcolor{red}{FALTA CITAR GFS/CFS!}.\\
\indent ...\\
\indent Os dados referentes a focos de \latim{Aedes} sp. são contabilizados no dia do próprio registro, ocorrendo apenas de segunda a sexta, e têm início no ano de 2012.\\
\indent A série histórica dos casos de dengue começa em 2014, sendo previamente agrupados e disponilizados em semanas epidemiológicas.\\
\indent Os \acrshort{DEE} e \acrshort{DEC} foram estruturados a ponto de compartilhar a mesma escala espaço-temporal. Os dados diários foram agrupados em semanas epidemiológicas, assim como o recorte espacial englobou área de estudo (figura \ref{fig:area_de_estudo}), o próprio Estado catarinense.
\begin{figure}[h]
    \centering
    \caption{Mapa temático da área de estudo do projeto evidenciando municípios catarinenses.}
    \includegraphics[scale=0.5]{figuras/area_de_estudo_SC_MATHEUS.pdf}
    \label{fig:area_de_estudo}
    \\
    \vspace{-0.05cm}\hspace{-7.5cm}\small{Fonte: Elaborado pelo próprio autor (2024).} 
\end{figure}

\indent Para melhor explicação dos métodos, pretende-se dividir o estudo em etapas, relativas ao percurso de execução do próprio projeto, sendo: pré-processamento dos dados; análise estatística descritiva; modelagem preditiva e validação do modelo; espacialização dos dados preditos e estudo de casos; além de síntese do \acrfull{PTT}.


\section{Pré-processamento dos Dados}

Em relação aos \acrshort{DEE}, devem ser orientados ao modo que possam ser concatenados, adicionados, uma planilha após a outra. Para tal, utilizou-se a linguagem \ingles{Python} (versão 3) \cite{python3_2009_van}  e a biblioteca \ingles{pandas} \cite{pandas_2010_scipy, pandas_2020_reback}, como pacote principal para estruturação dos dados . Outras também foram utilizadas, como: \ingles{numpy} \cite{numpy_2020_harrisarray}, para tratar dados faltantes e tipagem de variáveis; \ingles{datetime} \cite{python2_1995_van}, para padronização de todas as datas e variáveis desse tipo; e \ingles{geopandas} \cite{geopandas_2020_kelseyjordahl}, para manipular arquivos georreferenciados, extrair deles a nomenclatura padrão dos municípios do \acrshort{IBGE} e aplicar aos próprios dados.\\
\indent Os \acrshort{DEC} foram previamente tratados utilizando o \ingles{\acrfull{CDO}} \cite{CDO_2023_schulzweida}, assim, pôde-se unir dados diários para composição de meses e anos, por fim, sintetizando a série histórica. Com esse mesmo \ingles{software} se fez o primeiro recorte espacial, para o sul do Brasil, diminuindo o tamanho do arquivo principal. Para abertura e manipulação dos arquivos climáticos, na extensão \ingles{netCDF4}, utilizou-se a biblioteca \ingles{xarray} \cite{xarray_2016_v0_8_0, xarray_2017_hoyer}.\\
\indent Após isso, foram extraídos os valores dos elementos climáticos de cada município e armazenados em um novo formato de arquivo, \ingles{\acrfull{csv}} (valores separados por vírgulas), utilizando as bibliotecas \ingles{pandas}, \ingles{numpy}, \ingles{geopandas} e \ingles{shapely} \cite{shapely_2007_gillies}.\\
\indent Finalmente,  os principais conjuntos de dados (temperatura mínima, temperatura média, temperatura máxima, precipitação, focos de \latim{Aedes} sp. e casos de dengue) eram próprios arquivos estruturados em tabela dinâmica, onde as colunas eram cada município catarinense e as linhas, a serié histórica dada em semanas epidemiológicas no formato \ingles{datetime64[ns](YYYY-mm-dd)}. Logo, a equiparação entre essas variáveis era possível.


\section{Análise Estatística Descritiva}

\indent \textcolor{red}{ARGUMENTAR COM O ADRIANO}\\

\section{Modelagem Preditiva}

\indent Inicialmente, foram utilizados os pacotes \ingles{pandas}, \ingles{numpy} e \ingles{sklearn} \cite{scikit-learn_2011_pedregosa, sklearn_2013_buitinck}. Dessa maneira, os conjuntos de dados entomo-epidemiológicos e climatológicos foram estruturados em um único arranjo de dados para cada município. Essa estrutura foi composta pela variável dependente (entomológica ou epidemiológica) e por variáveis explicativas (elementos climáticos). Esse arranjo só foi possível com municípios que apresentavam todos os conjuntos de dados presentes. Sendo a variável dependente epidemiológica, é incluída a variável entomológica como explicativa. A configuração final do arranjo assumia, entre a variável dependente e as explicativas, horizonte preditivo de quatro (4) semanas epidemiológicas e retroação de oito (8) semanas epidemiológicas. Sendo a variável dependente epidemiológica, o horizonte preditivo de duas (2) semanas epidemiológicas e retroação de três (3) semanas epidemiológicas. Dessa última configuração, as variáveis explicativas (x) e dependente (y) foram divididas em dois conjuntos: treino e teste. Também foi previamente fixado um valor de gerador de números aleatórios (\ingles{seed}).\\
\indent Após isso, com a utilização dos pacotes \ingles{tensorflow}\cite{tensorflow_2015_whitepaper} e \ingles{keras} \cite{keras_2015_chollet}, do próprio \ingles{tensorflow}, fez-se a instanciação do modelo de rede neural. A primeira camada incluída (camada zero (0)) faz o achatamento dos dados de entrada (variáveis explicativas). Logo, foram adicionadas duas camadas densas (camadas: um (1) e dois (2)) com dez (10) nós (neurônios) cada e ativadas por uma função \ingles{\acrshort{ReLU}} (unidade linear retificada). Então, acionou-se uma camada de regularização (camada três (3)) e uma camada densa de saída (camada 4 (4)). Essa última camada foi criada com a quantidade de nós suficientes para receber o valor de saída (variável dependente) e ativada por uma função \ingles{softmax}. Finalmente, o modelo foi compilado com otimização da taxa de aprendizagem (0,01), configuração de perda (entropia cruzada categórica esparsa) e de métrica (acurácia). Foi ajustado com 100 ciclos (épocas) máximos de treinamento e alocados 20 porcento (0,2) para validação, sendo que o número de ciclos durante a fase de treino foi limitado por um monitor de valor de perda, assim o treinamento encerra antes de 100 ciclos.\\
\indent Para o modelo \ingles{random forest}, utilizou-se o pacote \ingles{sklearn} e o mesmo conjunto de treino e teste das variáveis explicativas (x) e dependente (y). Ao compilar, foi atribuído um número total de árvores presentes (100) e o gerador de números aleatórios (previamente citado) para, então, ajustar aos conjuntos de treino das variáveis explicativas (x) e dependente (y).




\section{Validação/Verificação dos Modelos}

\indent \textcolor{red}{Histograma do Erro (Obs - Pre)\\
\indent Intervalo de Confiança para o Erro\\
\indent Raiz Quadrada do Erro Quadrático Médio (RQEQM)\\
\indent Erro Médio Absoluto (EMA)\\
\indent Viés = EMA - RQEQM}\\

\indent \textcolor{red}{ARGUMENTAR COM O ADRIANO}\\

\section{Espacialização dos Dados Preditos}

\indent Para esse estudo, foi utilizado o recorte espacial durante a execução do prório \ingles{script}, sendo: longitude entre 54º5' e 57º5', ambas sul; e latitude entre 29º5' e 25º5', ambas oeste. Com esse recorte, pode-se evidenciar a totalidade do Estado de \acrlong{SC} e um pouco além de seus limites.\\
\indent Obteve-se os \ingles{shapefiles} do \acrshort{IBGE} (2022) para os limites territoriais (federal, estadual e municipais) do Estado de \acrlong{SC}.\\

\section{Estudo de Caso}

\indent Durante a quarta etapa, retorna-se ao acoplamento e espacialização, que resultará na determinação dos \acrfull{ICRe}. Esses \acrshort{ICRe} serão corrigidos pelo acoplamento dos \acrshort{DEC} à interação dos \acrshort{LACRe} e ajustados na distribuição do Estado de \acrlong{SC}. Após isso, os novos limiares serão aplicados ao modelo preditivo proposto \acrshort{SAMeT}-\acrshort{MERGE}-\acrshort{GFS}.


\section{Síntese do \acrfull{PTT}} 

\indent O \acrshort{PTT} resultante será: i) o sistema computacional e ii) a visualização cartográfica desses resultados, como preditivo da dinâmica regionalizada de focos de \latim{Aedes} sp. no Estado de \acrlong{SC}. O limiar temporal estipulado para previsão da incidência dos focos será de 60 dias. Os primeiros 30 dias serão determinados a partir do sistema \acrshort{SAMeT}-\acrshort{MERGE}. Os demais dias serão determinados através do modelo de previsão \acrshort{GFS}.


%\section{Conjutos de Dados Utilizados}
%sobre as arboviroses emergentes e re-mergentes (\textbf{Dengue}, Febre Amarela, Zika, Chikungunya)
%Tornar cada parte do método em objetivo específico
%ATUALIZAR, PENSANDO NO PROCESSO FUTURO\\


%A princípio, os dados de regionalização espacial encontram-se em processo de definição.




% \subsection{Pré-processamento dos Dados}
% \indent Para desenvolvimento do trabalho, os dados foram ajustados em mesma escala temporal, deixando-os em semanas epidemiológicas. Dessa forma, fez-se o somatório dos registros de focos de \latim{Aedes} sp. por semana epidemiológica. Mesmo tratamento foi realizado com a precipitação, retornando o acumulado de precipitação por semana epidemiológica. As temperaturas foram agrupadas de forma diferente, porém também ajustando a dados semanais. Ao final, teríamos a média das temperaturas (mínima, média e máxima) por semana epidemiológica.\\


